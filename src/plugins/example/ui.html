<!doctype html>
<html>
<head>
  <title></title>
	<style type="text/css">
//bootstrap.css
	</style>
  <style type="text/css">
    * {
      background: transparent;
    }
    .center {
        width: 50%;
        margin: 0 auto;
    }
    #content {
        width: 400px;
        margin: 0 auto;
    }
  </style>
</head>
<body>
  <div id="content">
    <h1>Example Airbitz Plugin</h1>
    <div class="panel panel-default">
        <div class="panel-heading">Wallets</div>
        <div class="panel-body">
            <table id="wallets" class="table table-stripped table-hover">
                <thead>
                  <tr><th>Wallet</th><th>Balance</th><th>Fiat</th></tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div id="requestPanel" class="panel panel-default">
        <div class="panel-heading">Request</div>
        <div class="panel-body">
            <button id="request">Receive Request</button>
            <button id="spend">Spend</button>
            <div id="center">
                <a id="address"></a>
            </div>
            <div id="qrcode" class="center">
            </div>
        </div>
    </div>
  </div>
  <script type="text/javascript">
//jquery.js
  </script>
  <script type="text/javascript">
//bootstrap.js
  </script>
  <script type="text/javascript">
//qrcode.min.js
  </script>
  <script type="text/javascript">
//airbitz-bridge.js
  </script>
  <script type="text/javascript">
//airbitz-core.js
  </script>
  <script type="text/javascript">
    var selected = null;
    window.onload = function() {
        var fiat = function(satoshi, currencyNum) {
          var value = Airbitz.core.satoshiToCurrency(satoshi, currencyNum);
          return Airbitz.core.formatCurrency(value, currencyNum, true);
        }
        var $qrcode = $('#qrcode');
        var qrcode = new QRCode($qrcode[0], {
            width: 128,
            height: 128,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });
        var title = 'Example App';
        Airbitz.ui.title(title);
        Airbitz.ui.title('Loading wallets...');
        Airbitz.core.wallets({success: function(data) {
          $.each(data, function(index, wallet) {
              $td1 = $('<td />').append(wallet.name);
              $td2 = $('<td />').append(Airbitz.core.formatSatoshi(wallet.balance, true));
              $td3 = $('<td />').append(fiat(wallet.balance, wallet.currencyNum));
              $d = $('<tr/>').append($td1).append($td2).append($td3);
              $d.click(function() {
                  selected = wallet;
                  $('#request').html('Receive Request for ' + wallet.name);
                  $('#requestPanel').show()
              });
              $('#wallets tbody').append($d);
              Airbitz.ui.title(title);
          });
        }});
        $('#requestPanel').hide()
        $('#request').click(function() {
            Airbitz.ui.title('Loading receive request...');
            Airbitz.core.createReceiveRequest(selected, {success: function(data) {
              var address = data['address'];
              var uri = "bitcoin://" + address;
              var $address = $('#address');
              $qrcode.attr('href', uri);
              $address.html('Pay to ' + address);
              $address.attr('href', uri);
              qrcode.makeCode(uri);
              Airbitz.ui.title(title);

              $('#spend').click(function() {
                Airbitz.core.requestSpend(selected, address, 10000, {success: function(data) {
                }});
              });
            }});
        });
    }
  </script>
</body>
</html>
